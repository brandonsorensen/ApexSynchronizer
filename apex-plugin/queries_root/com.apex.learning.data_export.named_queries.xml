<queries>
    <query name="com.apex.learning.school.students" coreTable="STUDENTS" flattened="false">
        <description>Gets students to update Apex Learning environment.</description>
        <args>
        </args>
        <columns>
			<column column="STUDENTS.ID">STUDENT_ID</column>
			<column column="STUDENTS.FIRST_NAME">FIRST_NAME</column>
			<column column="STUDENTS.MIDDLE_NAME">MIDDLE_NAME</column>
			<column column="STUDENTS.LAST_NAME">LAST_NAME</column>
			<column column="STUDENTS.WEB_ID">WEB_ID</column>
			<column column="STUDENTS.STATE_STUDENTNUMBER">EDUID</column>
			<column column="STUDENTS.GRADE_LEVEL">GRADE_LEVEL</column>
			<column column="STUDENTS.SCHOOLID">SCHOOL_ID</column>
			<column column="U_DEF_EXT_STUDENTS.STUDENTEMAIL">EMAIL</column>
 		</columns>
        <sql>
			<![CDATA[
				SELECT  students.id,
						students.First_Name,
						students.Middle_Name,
						students.Last_Name,
						students.Web_ID,
						students.State_StudentNumber,
						students.Grade_Level,
						students.schoolid,
						u_def_ext_students.studentemail
				FROM    students
						INNER JOIN u_def_ext_students
						ON students.dcid = u_def_ext_students.studentsdcid
				WHERE   students.schoolid in (501, 601, 616)
						AND students.Enroll_Status = 0
				ORDER BY students.id
			]]>
        </sql>
    </query>
    <query name="com.apex.learning.school.classrooms" coreTable="" flattened="false">
        <description>Gets sections to update Apex Learning classrooms.</description>
        <args>
        </args>
        <columns>
			<column column="SECTIONS.ID">SECTION_ID</column>
			<column column="SECTIONS.SCHOOLID">SCHOOL_ID</column>
			<column column="COURSES.COURSE_NAME">COURSE_NAME</column>
			<column column="SECTIONS.SECTION_NUMBER">SECTION_NUMBER</column>
			<column column="TEACHERS.ID">TEACHER_ID</column>
			<column column="TEACHERS.FIRST_NAME">TEACHER_FIRST_NAME</column>
			<column column="TEACHERS.MIDDLE_NAME">TEACHER_MIDDLE_NAME</column>
			<column column="TEACHERS.LAST_NAME">TEACHER_LAST_NAME</column>
			<column column="TERMS.FIRSTDAY">FIRST_DAY</column>
			<column column="SECTIONS.DEPENDENT_SECS">APEX_PROGRAM_CODE</column>
 		</columns>
        <sql>
			<![CDATA[
				SELECT s.id as sec_id, 
					   s.schoolid,
					   c.course_name, 
					   s.section_number, 
					   t.id as t_id,
					   t.first_name, 
					   t.middle_name,
					   t.last_name, 
					   terms.firstday ,
					   s.dependent_secs
				FROM   sections s 
					   LEFT JOIN courses c 
							  ON c.course_number = s.course_number 
					   LEFT JOIN teachers t 
							  ON s.teacher = t.id 
					   LEFT JOIN terms 
							  ON terms.id = s.termid 
								 AND terms.schoolid = s.schoolid 
				WHERE  s.schoolid = 616
					   AND c.course_name LIKE '%(APEX)'
				ORDER BY sec_id
			]]>
        </sql>
    </query>
    <query name="com.apex.learning.school.teachers" coreTable="" flattened="false">
        <description>Gets sections to update Apex Learning classrooms.</description>
        <args>
			<arg name="min_term" required="true" description="Minimum term ID"
				 type="primitive" default="2900" column="terms.id"/>
        </args>
        <columns>
			<column column="TEACHERS.ID">TEACHER_ID</column>
			<column column="TEACHERS.FIRST_NAME">FIRST_NAME</column>
			<column column="TEACHERS.MIDDLE_NAME">MIDDLE_NAME</column>
			<column column="TEACHERS.LAST_NAME">LAST_NAME</column>
			<column column="TEACHERS.EMAIL_ADDR">EMAIL</column>
			<column column="TEACHERS.TEACHERNUMBER">TEACHER_NUMBER</column>
			<column column="TEACHERS.SCHOOLID">SCHOOL_ID</column>
 		</columns>
        <sql>
			<![CDATA[
				SELECT id,
					   first_name,
					   middle_name,
					   last_name,
					   email_addr,
					   teachernumber,
					   schoolid
				FROM   teachers
				WHERE  teachers.schoolid in (501, 601, 616)
				ORDER BY teachers.id
			]]>
        </sql>
    </query>
    <query name="com.apex.learning.school.enrollment" coreTable="" flattened="false">
        <description>Gets sections to update Apex Learning classrooms.</description>
        <args>
        </args>
        <columns>
			<column column="STUDENTS.STATE_STUDENTNUMBER">EDUID</column>
			<column column="CC.SECTIONID">SECTION_ID</column>
 		</columns>
        <sql>
			<![CDATA[
				SELECT students.State_StudentNumber,
					   cc.sectionid
				FROM   cc
					   INNER JOIN students
							   ON cc.studentid = students.id
					   INNER JOIN courses
					   		   ON cc.course_number = courses.course_number
				WHERE  cc.schoolid = 616
					   AND students.enroll_status = 0
					   AND courses.course_name LIKE '%(APEX)'
				GROUP  BY students.State_StudentNumber, cc.sectionid
				ORDER  BY students.State_StudentNumber
			]]>
        </sql>
    </query>
</queries>
